<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gandi SSL avec Nginx by jlecour</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Gandi SSL avec Nginx</h1>
        <p>Un guide pour configurer un certificat SSL (Gandi) pour Nginx sur Debian</p>
        <p class="view"><a href="https://github.com/jlecour/ssl-gandi-nginx-debian">View the Project on GitHub <small>jlecour/ssl-gandi-nginx-debian</small></a></p>
        <ul>
          <li><a href="https://github.com/jlecour/ssl-gandi-nginx-debian/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jlecour/ssl-gandi-nginx-debian/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jlecour/ssl-gandi-nginx-debian">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <blockquote>
<p>Je découvre le sujet, j'ai donc probablement fait des confusions, raté des conventions, mélangé des concepts, et peut-être même insulté des divinités.
N'hésitez pas à utiliser tous les moyens nécessaires (<a href="https://github.com/jlecour/ssl-gandi-nginx-debian/issues/new">issue</a> ou <a href="https://github.com/jlecour/ssl-gandi-nginx-debian/pulls">pull-request</a> GitHub, <a href="https://twitter.com/jlecour" title="@jlecour">twitter</a>, mail …) pour me faire vos retours, sur le fond comme sur la forme.</p>
</blockquote>

<p><strong>Sommaire</strong> :</p>

<ol>
<li><a href="#1-objectif">Objectif</a></li>
<li><a href="#2-cr%C3%A9ation-du-certificat">Création du certificat</a></li>
<li><a href="#3-configuration-du-serveur">Configuration du serveur</a></li>
<li><a href="#4-v%C3%A9rifications">Vérifications</a></li>
<li><a href="#5-ressources-utiles">Ressources utiles</a></li>
</ol>

<h1>
<a id="1-objectif" class="anchor" href="#1-objectif" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Objectif</h1>

<p>L'objectif est de protéger les communications entre un serveur web et ses clients en SSL et en respectant le plus possible les règles de l'art, mais dans un contexte précis, celui de certificats <em>wildcard</em> délivrés par Gandi.</p>

<p>Tous les fichiers sont présents dans l'arborescence partant de <a href="etc">/etc</a> : config Nginx, fichiers de certificat, …
Ils correspondent à un vrai certificat, pour le domaine <code>www.example.com</code>, sauf que Gandi ne l'a jamais réellement généré et son contenu est bidon.</p>

<p>La plupart des commandes décrites ici doit être exécutée par un utilisateur privilégié, comme <strong>root</strong>.
Seules les commandes liées au vérification post-installation peuvent être exécutées avec un utilisateur normal.</p>

<h2>
<a id="certificat-wildcard-ssl-standard-délivré-par-gandi" class="anchor" href="#certificat-wildcard-ssl-standard-d%C3%A9livr%C3%A9-par-gandi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Certificat <em>wildcard</em> SSL Standard, délivré par Gandi</h2>

<p>Ce type de certificat coûte environ 120 €/an. Il permet de protéger avec un même certificat tous les sous-domaines (de premier niveau) d'un nom de domaine principal.</p>

<p>Il est délivré automatiquement et assez rapidement (moins d'1 heure).</p>

<p>Vous pouvez aussi opter pour un certificat <strong>SSL Pro</strong> (<em>wildcard</em> ou pas). Il coûtera plus cher, nécessitera une vérification de documents, mais vous apportera une garantie financière.</p>

<p>La procédure décrite ici concerne donc les certificats <strong>SSL Standard</strong> mais fonctionne avec les certificats <strong>SSL Pro</strong>.</p>

<h2>
<a id="niveau-intermediate" class="anchor" href="#niveau-intermediate" aria-hidden="true"><span class="octicon octicon-link"></span></a>Niveau <em>intermediate</em>
</h2>

<p>Dans son guide <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" title="Server Side TLS">Server-Side TLS</a>, Mozilla propose 3 niveaux de configuration. Pour chacun, voici les plus anciens clients compatibles, par niveau :</p>

<ul>
<li>
<strong>modern</strong> : Firefox 27, Chrome 22, IE 11, Opera 14, Safari 7, Android 4.4, Java 8</li>
<li>
<strong>intermediate</strong> : Firefox 1, Chrome 1, IE 7, Opera 5, Safari 1, Windows XP IE8, Android 2.3, Java 7</li>
<li>
<strong>old</strong> : Windows XP IE6, Java 6</li>
</ul>

<p>Nous allons opter pour une configuration <strong>intermediate</strong>, qui nous permet d'avoir un <strong>bon compromis compatibilité/sécurité</strong>.</p>

<h3>
<a id="sha-2" class="anchor" href="#sha-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>SHA-2</h3>

<p>Au niveau <strong>intermediate</strong> nous avons le choix entre des certificats SHA-1 ou SHA-2 (256 bits).</p>

<p>Nous allons choisir SHA-2 pour être plus "compatible" avec la tendance des navigateurs récents. En effet, <a href="http://blog.chromium.org/2014/09/gradually-sunsetting-sha-1.html">Google déprécie progressivement les certificats SHA-1</a>.</p>

<p>Pour les certificats SHA-2, certains navigateurs n'ont pas encore ajouté les certificats racines. Il est donc prudent de les rajouter manuellement dans les chaînes de certification. Le <a href="http://wiki.gandi.net/fr/ssl/intermediate">Wiki de Gandi</a> apporte plus de précision sur la récupération des certificats intermédiaires.</p>

<h3>
<a id="hsts-http-strict-transport-security" class="anchor" href="#hsts-http-strict-transport-security" aria-hidden="true"><span class="octicon octicon-link"></span></a>HSTS: HTTP Strict Transport Security</h3>

<p>Si votre site ne doit être consultable qu'en HTTPS, l'en-tête HTTP <code>Strict-Transport-Security</code> (HSTS) permettra de s'assurer que les navigateurs refuseront toute connexion non chiffrée sur votre domaine. La durée de vie de l'en-tête doit être assez longue : la valeur conseillée est de 180 jours, mais c'est souvent 365 jours que l'on rencontre dans la configuration.</p>

<p>Il est possible d'être conforme à la configuration <strong>intermediate</strong> sans appliquer HSTS, mais si vous pouvez vous permettre de n'autoriser que des échanges chiffrés, je vous le recommande.</p>

<h2>
<a id="nginx" class="anchor" href="#nginx" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nginx</h2>

<p>Nginx est une excellente terminaison SSL/TLS, en particulier à partir de la version 1.6. C'est le serveur web que nous utilisons déjà, donc nous aurons facilement accès aux meilleurs configurations possibles.</p>

<h2>
<a id="debian" class="anchor" href="#debian" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debian</h2>

<p>Le type de système importe peut (tant qu'il ressemble à un Linux/Unix). Nous utiliserons Debian (wheezy) car c'est la distribution qui est sur nos serveurs à ce jour.</p>

<p>La seule différence que vous risquer de rencontrer est l'emplacement de certains fichiers.</p>

<h1>
<a id="2-création-du-certificat" class="anchor" href="#2-cr%C3%A9ation-du-certificat" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Création du certificat</h1>

<h2>
<a id="formats-de-certificats" class="anchor" href="#formats-de-certificats" aria-hidden="true"><span class="octicon octicon-link"></span></a>Formats de certificats</h2>

<p>Les certificats sont fréquemment représentés dans un de ces 2 formats : <strong>DER</strong> et <strong>PEM</strong>. <strong>PEM</strong> étant le format par défaut d'OpenSSL, nous allons surtout manipuler des certificats, clés, chaînes de certificats, etc. de ce type.</p>

<p>Les outils fournis par OpenSSL facilitent la conversion d'un format à l'autre.</p>

<h2>
<a id="demande-démission-dun-certificat" class="anchor" href="#demande-d%C3%A9mission-dun-certificat" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demande d'émission d'un certificat</h2>

<p>Il faut commencer par générer une clé privée (<code>*.key.pem</code>) et une demande de certificat (<code>*.csr.pem</code>).
Pour éviter de faire transiter la clé privée dans un dossier non protégé, on la génère directement dans le dossier final (<code>/etc/ssl/private</code>) qui doit avoir les droits <code>drwx--x---</code> et appartenir à <code>root:ssl-cert</code>.</p>

<pre><code>→ openssl req -nodes -newkey rsa:2048 -sha256 -keyout /etc/ssl/private/wildcard_example_com.key.pem -out wildcard_example_com.csr.pem
</code></pre>

<pre><code>Country Name (2 letter code) [AU]:FR
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:Marseille
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Example Inc.
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:*.example.com
Email Address []:contact@example.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre>

<p>Le contenu du CSR devra être transmis à Gandi.</p>

<pre><code>→ cat wildcard_example_com.csr.pem
</code></pre>

<pre><code>-----BEGIN CERTIFICATE REQUEST-----
MIICzzCCAbcCAQAwgYkxCzAJBgNVBAYTAkZSMRMwEQYDVQQIEwpTb21lLVN0YXRl
MRIwEAYDVQQHEwlNYXJzZWlsbGUxFTATBgNVBAoTDEV4YW1wbGUgSW5jLjEWMBQG
A1UEAxQNKi5leGFtcGxlLmNvbTEiMCAGCSqGSIb3DQEJARYTY29udGFjdEBleGFt
cGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKO13wEpS2Ka
unLpJVLF2AqYVZV4OK7p7OG4IfVhkK5wP/kh8KYxyOHZZDx+rGfJE1UA8dJQd+EV
xST0tdN2tw0Dv0jSv6SjXoQO1inTbDf+qixxAj/RxAVmn8AuWC3g/YtI7Wikb3PO
+h81Ezb7i4rkZGYoFleDOpprQvxZEKVXOyU9bumKJRY3YO7xmwdV1pVt+vwgyR+8
sI1R7OCglPwdYlRD9R0ZFEzpPYkDmY7qkx9Jk+TJNewSyS4wy6qg6Neguxg+hYaD
MLY5kXmhmRBHlTaOznbi8m/lEIszH9/r+4weDjt66DPEmM0vUEl3p8dZUb2Nkn7n
gBOCM4/mdhcCAwEAAaAAMA0GCSqGSIb3DQEBCwUAA4IBAQAri8Gtz2SkiBMXb4Me
ICL/exVrM6q03wcrFSOE9XJbcyOOA1gP8+zWNcNlMyfd/MpB5lNRPdzKT01zb17z
kiteEDTSvGMTwklWJN08hJDXPXs2POnQDZau/FEAvLM8jWheq+UzSsIsuSju1MUJ
ra8d/3FH25J5eRCvy63tPpje9qk+EoHxO5g22QCcgXIc2CANicLNjTKkECG+TRN1
WMmir+a2+raBgNZCrE5N87SsfHnhPZEJExXL5AuKTAOH3FcBb0G1f4KcKPgULbrE
aH9rpFywuEMgnkp3eRoxtPs7UuTVTaNIjCJX+Q5oY2eT6cH1UVwn8qnJe1j8S6Mx
CGi7
-----END CERTIFICATE REQUEST-----
</code></pre>

<p>La clé privée ne doit être <strong>communiquée à personne</strong> et être stockée de manière <strong>sécurisée</strong> sur votre serveur (attention aux permissions). Ici, il s'agit d'un certificat factice : le dévoiler ne présente aucun risque.</p>

<pre><code>→ cat wildcard_example_com.key.pem
</code></pre>

<pre><code>-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAo7XfASlLYpq6cuklUsXYCphVlXg4runs4bgh9WGQrnA/+SHw
pjHI4dlkPH6sZ8kTVQDx0lB34RXFJPS103a3DQO/SNK/pKNehA7WKdNsN/6qLHEC
P9HEBWafwC5YLeD9i0jtaKRvc876HzUTNvuLiuRkZigWV4M6mmtC/FkQpVc7JT1u
6YolFjdg7vGbB1XWlW36/CDJH7ywjVHs4KCU/B1iVEP1HRkUTOk9iQOZjuqTH0mT
5Mk17BLJLjDLqqDo16C7GD6FhoMwtjmReaGZEEeVNo7OduLyb+UQizMf3+v7jB4O
O3roM8SYzS9QSXenx1lRvY2SfueAE4Izj+Z2FwIDAQABAoIBAQCO7LlEykiGTY95
wxJSsWdr2JLfa5YRHykv5xG+qO8nW9h+KKNwdQZsJt7b8buS4HmAPNLiSl5epCL5
oKsdcwdc1Wiqq1Ok6PwbTtiqq2pPeIYZRpAwJ3J7RJ0zq0JQy5yPfZvHP8gN0yWL
GUstNW8eU0dT6KuYu3juV7ajmR5vOdNeGcxftA/gN0SQGlSuK14K2pyZAirBejNc
RozPtC4tF6XLgrUUcmYlw2q5Uji5jJah8LZQEf6rFi36y43iteYE+7bz/gnBZ7tP
7y7SozkvtZ8tVUl8I0LtNz3KOv/ukTasNFBIQpWK5auU2n4BMw047nSPP4nWL5+J
TOaGu0ABAoGBANE5obJtNtNh+zgNv9qKAjHAvBgg+T43bZoqgQJzXsoKveezQ6K7
x+4yZ7nie2WoKoRO2w3Gsa0JHqoslK6bg3MVaabU1miLR73UFkHPW5qkMzSb9ndN
P/v/LWO1glbHMqO9kewdJoJEjFwUoWVdEKQvUW5ZoLya3wHU8Ab1vTtBAoGBAMhP
V/eA57lF9Pq+aEfljyaXvASzgAJM8KQHyG16I3LiK5CFVIHPrDvCH4HybeuwCG7S
HfM29678DzZpTHfplfnKXlPoG/QJCsiKUtn3OMTHyiUsHT/j2juqA6cZ3/0G5LO8
4zNQpLrrzgrrf4P/p6pXVZKmIERTdDVBhaWkUZNXAoGACzzNMogrKa9ZjukuJM7E
z2dKswESYgUYHe+qfjc0ICXzjT5To6nyUxjh+VnwxsUBg5m4qkTBxkl3HCzIz5gK
t2OvCQblfTf94nRBvcclZGjtVyYJVt8PULmj9ncJSR/p2GGWNNhb+SM1Zry07nzR
KABin0qxF3A6Ch8lxTntsAECgYEAvVWR9lYXsZ4YUzHK67pmNrpRc7gfFQ2Yn9Lj
deduvlZdizsbh5++UrXIhlGZ6J75OZbNzGh2cSW7U1jweJ+HrRXFV1Ybpe0uDiQA
8BmnxQh7X+t0skEytBadYUMp3sa3QdUWhBiDvFLK7LNwUlpCJtZqAjWYZjzjqLsI
Emtg1/0CgYA214z3XCLXqenPDcJuYHoKaDNY7hBJpcMx+PC/djHa5lbFCYzfhg7h
A+sH/qFmLTkb3Ha+S4uRTWlEfMk7iliwAGfGhYBTCjUQiqdLdwSkO6YBey0nXZLJ
E0pV7+shRPoK7jguy6zzSHK1ygWnqTSn8TePgtIXOoVcZoH6jQBfcA==
-----END RSA PRIVATE KEY-----
</code></pre>

<p>Gandi propose une vérification par enregistrement DNS, par fichier texte ou par envoi d'un e-mail. Chacune a bien sûr ses avantages et inconvénients.</p>

<p>Si votre serveur est déjà configuré ou si vous avez déjà une adresse email "<a href="mailto:admin@example.com">admin@example.com</a>", alors ces 2 méthodes sont les plus rapides.</p>

<p>L'enregistrement DNS vous permet d'effectuer la vérification même si le reste de votre infrastructure n'est pas encore prêt. La première vérification n'intervient en revanche que 25 minutes après la demande de création du certificat (puis toutes les 5 minutes jusqu'au succès).</p>

<p>Une fois la validation effectuée, vous pouvez récupérer votre certificat et le stocker dans <code>/etc/ssl/certs/wildcard_example_com.crt.pem</code>.</p>

<h1>
<a id="3-configuration-du-serveur" class="anchor" href="#3-configuration-du-serveur" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Configuration du serveur</h1>

<h2>
<a id="forward-secrecy" class="anchor" href="#forward-secrecy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Forward Secrecy</h2>

<p>Dans un mécanisme de chiffrement d'un échange à partir d'une clé privée, le problème est que si on met la main sur cette clé, tous les échanges passés et futurs deviennent lisibles. La révocation d'un certificat ne protège pas le déchiffrement de ce qui a été chiffré dans le passé. Dans une situation de surveillance des échanges, on peut tout intercepter/stocker et se dire qu'il sera peut-être possible de tout déchiffrer plus tard. Les agences de renseignement sont soupçonnées d'appliquer ce genre de stratégie.</p>

<p>Le principe de <strong>Forward Secrecy</strong> est que le client et le serveur se mettent d'accord sur une clé temporaire de chiffrement. Cette clé restera accessible uniquement le temps de la session TLS. Si une de ces clés est récupérée ou découverte, seules les échanges de la session en question seront compromis.</p>

<p>Pour faire fonctionner ce mécanisme, le client et le serveur doivent procéder à un <strong>échange de clés Diffie-Hellman</strong>. Le serveur va communiquer au client un (très grand) nombre premier et un générateur. Pour éviter un compromission de type <a href="http://fr.wikipedia.org/wiki/Attaque_de_l%27homme_du_milieu" title="Man In The Middle">MITM</a>, le serveur signe l'échange avec sa clé privée. Les paramètres de l'échange sont déterminés à l'avance et stockés sur le serveur.</p>

<p>OpenSSL permet de générer le nombre premier et le générateur ainsi que de choisir leur complexité, exprimée en bits. La complexité la plus courante est <strong>2048 bits</strong>. De plus en plus <strong>4096 bits</strong> sont recommandés, mais les systèmes anciens (tels que Java 6 ou IE6) ne supportent pas plus de <strong>1024 bits</strong>.</p>

<p>Au niveau <strong>intermediate</strong> il vaut mieux utiliser (au moins) 2048 bits, même si 1024 bits sont acceptables. Dans notre cas, nous utiliserons 2048 bits, car même le niveau <strong>modern</strong> n'impose pas 4096 bits.</p>

<p>Attention, la génération des paramètres Diffie-Hellman peut prendre plusieurs minutes :</p>

<pre><code>→ cd /etc/ssl/ \
&amp;&amp; openssl dhparam -rand – 2048 -out dhparam-2048.pem \
&amp;&amp; ln -s dhparam-2048.pem dhparam.pem
</code></pre>

<p>En sortie, le fichier devrait ressembler à ça :</p>

<pre><code>-----BEGIN DH PARAMETERS-----
MZ9wdNIzSPihtIKQLMBF1GS6UJKjIQznU06XeY0d5u4LanYngWCTFPaa3MqN9h/Z
ThWGYMx7Aa6I82Tao0my2ee6jvOC5yc9dSEW51cjHdhjASzhtUEoIXLGTasfp2QF
ZA85bq8/iU/n8qGYvSk5ieP1xhOI07YxaReER/0wmG9rHIBrnYn2j5nYSxfcPfsQ
oqzyJPg+dp7vifJAWxj/2jkzbUK9Ij3hHiFitdNCmqRqCpIjrU6Zq+ZenRz9T3KE
QZK68V0RM3hBt6CVQ80vfhYmT+3f54gNB9jfeHCwqLCYotWdmO7Q03FR+mgA4Zhg
A/q9Cm/STK80ZQkdnfdm7qnJFG/+vJ7LTdIN4L1vMxkaMg2c5q63FQpdPCAQI=
-----END DH PARAMETERS-----
</code></pre>

<p>Pour faciliter l'utilisation de plusieurs niveaux de complexité selon les installations (ou les essais), nous avons écrit le fichier avec un suffixe explicite puis créé un lien symbolique avec la commande <code>ln -s</code>.</p>

<h2>
<a id="hiérarchie-des-certificats" class="anchor" href="#hi%C3%A9rarchie-des-certificats" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hiérarchie des certificats</h2>

<p>Pour vérifier l'authenticité des certificats, les clients s'appuient sur un ensemble de certificats racines. Tous les certificats sont signés à partir de ces <strong>certificats racines</strong> ou de certificats descendant eux-mêmes de ces certificats racines : les ceritificats intermédiaires. Généralement, ce sont ces derniers qui sont utilisés pour signer nos certificats finaux.</p>

<p>Dans notre cas, nous avons :</p>

<ul>
<li>la racine (0) <code>AddTrust External Root</code>
</li>
<li>la branche (1) <code>USERTrust RSA AddTrust CA</code>
</li>
<li>la branche (2) <code>Gandi Standard SSL CA2</code>
</li>
<li>la feuille (3) <code>*.example.com</code>
</li>
</ul>

<p>Notez bien cet ordre car il nous servira pour créer les deux fichiers de chaîne.</p>

<h2>
<a id="fichier-de-la-chaîne-de-certificats" class="anchor" href="#fichier-de-la-cha%C3%AEne-de-certificats" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fichier de la chaîne de certificats</h2>

<p>Il est nécessaire d'indiquer au serveur web non seulement le certificat de notre domaine, mais aussi tous les certificats intermédiaires.</p>

<p>Le certificat racine étant connu, nous allons créer un fichier <code>/etc/ssl/certs/wildcard_example_com.chain.pem</code> qui contiendra, dans l'ordre, les trois niveaux restants :</p>

<ul>
<li>le certificat généré par Gandi (<strong>feuille 3</strong>) ;</li>
<li>le certificat intermédiaire de Gandi (<strong>branche 2</strong>) ;</li>
<li>le certificat <em>cross-signed</em> (<strong>branche 1</strong>).</li>
</ul>

<p>Pour générer le fichier de chaîne :</p>

<pre><code>→ cd /etc/ssl/certs/ \
&amp;&amp; echo -n '' &gt; wildcard_example_com.chain.pem \
&amp;&amp; cat wildcard_example_com.chain.pem | tee -a wildcard_example_com.chain.pem \
&amp;&amp; wget -O - https://www.gandi.net/static/CAs/GandiStandardSSLCA2.pem | tee -a wildcard_example_com.chain.pem&gt; /dev/null \
&amp;&amp; wget -O - http://crt.usertrust.com/USERTrustRSAAddTrustCA.crt | openssl x509 -inform DER -outform PEM | tee -a wildcard_example_com.chain.pem&gt; /dev/null
</code></pre>

<p>Explications :</p>

<ul>
<li>on se place dans <code>/etc/ssl/certs</code> ;</li>
<li>le <code>echo</code> crée un fichier vide ;</li>
<li>on ajoute le certificat du domaine (directement au format <code>PEM</code>) ;</li>
<li>on ajoute le certificat de Gandi (directement au format <code>PEM</code>) ;</li>
<li>on ajoute le certificat <em>cross-signed</em> (au format <code>DER</code> il faut donc le convertir avant de l'ajouter) ;</li>
<li>l'utilisation de <code>tee</code> permet d'ajouter un <code>sudo</code> si besoin.</li>
</ul>

<p>Pour des certificats <strong>SSL Pro</strong>, le certificat intermédiaire de Gandi est différent, mais le principe et les manipulations sont identiques.</p>

<h2>
<a id="fichier-des-certificats-agrafés-stapling" class="anchor" href="#fichier-des-certificats-agraf%C3%A9s-stapling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fichier des certificats agrafés (<em>stapling</em>)</h2>

<p>La plupart des clients qui se connecteront au serveur web voudront vérifier la non-révocation du certificat. Deux stratégies permettent cette vérification : via un fichier CRL (<em>Certificate Revocation List</em>), mais vu le nombre de certificats en circulation ça devient impraticable, ou alors via une interrogation OCSP (<em>Online Certificate Status Protocol</em>).</p>

<p>Pour éviter au client de faire une requête additionnelle, le serveur peut mettre en cache le résultat de cette vérification et la servir directement au client. Pour cela il faut indiquer à Nginx la liste des certificats, concaténés dans un seul fichier.</p>

<p>Les certificats doivent être dans l'ordre de la hiérarchie, en partant de celui qui a signé notre certificat (ici <code>GandiStandardSSLCA2</code>) et en remontant jusqu'à la racine.</p>

<p>Nous allons créer le fichier <code>/etc/ssl/certs/gandi-standardssl-2.chain.pem</code> qui contiendra, dans l'ordre :</p>

<ul>
<li>le certificat intermédiaire de Gandi (<strong>branche 2</strong>) ;</li>
<li>le certificat <em>cross-signed</em> (<strong>branche 1</strong>);</li>
<li>le certificat racine (<strong>racine 0</strong>).</li>
</ul>

<p>Voici la commande :</p>

<pre><code>→ cd /etc/ssl/certs/ \
&amp;&amp; echo -n '' &gt; gandi-standardssl-2.chain.pem \
&amp;&amp; wget -O - https://www.gandi.net/static/CAs/GandiStandardSSLCA2.pem | tee -a gandi-standardssl-2.chain.pem&gt; /dev/null \
&amp;&amp; wget -O - http://crt.usertrust.com/USERTrustRSAAddTrustCA.crt | openssl x509 -inform DER -outform PEM | tee -a gandi-standardssl-2.chain.pem&gt; /dev/null \
&amp;&amp; cat AddTrust_External_Root.pem | tee -a gandi-standardssl-2.chain.pem
</code></pre>

<h2>
<a id="récapitulatif-des-fichiers-de-certificats" class="anchor" href="#r%C3%A9capitulatif-des-fichiers-de-certificats" aria-hidden="true"><span class="octicon octicon-link"></span></a>Récapitulatif des fichiers de certificats</h2>

<p><strong><code>/etc/ssl/certs/gandi-standardssl-2.chain.pem</code></strong></p>

<p>C'est la chaîne des certificats à utiliser pour <em>OCSP stapling</em>. Ce fichier peut être utilisé par plusieurs certificats <strong>Gandi Standard SSL</strong>.</p>

<p>Il n'est pas indispensable pour faire fonctionner le domaine en HTTPS mais c'est utile pour les performances du site.</p>

<p><strong><code>/etc/ssl/certs/wildcard_example_com.chain.pem</code></strong></p>

<p>Il contient le certificat du domaine et les certificats intermédiaires.</p>

<p><strong><code>/etc/ssl/certs/wildcard_example_com.crt.pem</code></strong></p>

<p>Il contient seulement le certificat du domaine. Il ne sera pas utilisé directement par le serveur web, mais il est pratique de le conserver.</p>

<p><strong><code>/etc/ssl/private/wildcard_example_com.csr.pem</code></strong></p>

<p>C'est le fichier contenant la demande de création d'un certificat. Il est inutile sur le serveur, mais il est intéressant de le conserver pour vérifier comment la demande initiale avait été effectuée.</p>

<p><strong><code>/etc/ssl/private/wildcard_example_com.key.pem</code></strong></p>

<p>C'est la clé privée du certificat. Ce fichier est indispensable.</p>

<h3>
<a id="droits-daccès" class="anchor" href="#droits-dacc%C3%A8s" aria-hidden="true"><span class="octicon octicon-link"></span></a>droits d'accès</h3>

<p>La clé privée doit être accessible uniquement en lecture et par le seul compte root. Il est recommandé de créer la clef privée directement dans un dossier accessible uniquement par root (par exemple: /etc/ssl/private).</p>

<pre><code>→ chmod 640 /etc/ssl/private/wildcard_example_com.key.pem
→ chown root:ssl-cert /etc/ssl/private/wildcard_example_com.key.pem
</code></pre>

<p>Les fichiers présents dans <code>/etc/ssl/certs</code> peuvent être accessibles en lecture à tout le monde, mais seulement aux administrateurs pour l'écriture.</p>

<h2>
<a id="nginx-1" class="anchor" href="#nginx-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nginx</h2>

<p>La configuration de Nginx se fait via le fichier <code>/etc/nginx/nginx.conf</code>, dans lequel on trouve des réglages généraux. Il y aussi une section pour la partie <code>http</code> dans laquelle on trouve des sections <code>server</code>. Toutes ces sections sont appelées <strong>bloc</strong> car elles utilisent une syntaxe à base d'accolades et sont imbriquées.</p>

<p>Par habitude on extrait souvent les blocs spécifiques aux sites et applications gérées dans des fichiers spécifiques, que l'on inclut ensuite dans la configuration principale via la directive <code>include</code>.</p>

<p>Voici un exemple typique de configuration :</p>

<pre><code>→ cat /etc/nginx/nginx.conf
</code></pre>

<div class="highlight highlight-nginx"><pre><span class="pl-k">user</span> www-data;
<span class="pl-k">worker_processes</span> <span class="pl-s1">32</span>;
<span class="pl-k">pid</span> /var/run/nginx.pid;

<span class="pl-st">events</span> {
  <span class="pl-k">worker_connections</span> <span class="pl-s1">768</span>;
}

<span class="pl-st">http</span> {
  <span class="pl-k">sendfile</span><span class="pl-c1"> on</span>;
  <span class="pl-k">tcp_nopush</span><span class="pl-c1"> on</span>;
  <span class="pl-k">tcp_nodelay</span><span class="pl-c1"> on</span>;
  <span class="pl-k">keepalive_timeout</span> <span class="pl-s1">65</span>;

  <span class="pl-k">include</span> /etc/nginx/mime.types;
  <span class="pl-k">default_type</span> application/octet-stream;

  access_log /var/log/nginx/access.log;
  <span class="pl-k">error_log</span> /var/log/nginx/error.log;

  <span class="pl-k">include</span> /etc/nginx/sites-enabled/*;
}</pre></div>

<p>Ici on voit que tous les fichiers présents dans <code>/etc/nginx/sites-enabled</code> sont automatiquement inclus. Nous allons placer notre configuration pour le site <code>www.example.com</code> dans <code>/etc/nginx/sites-enabled/www_example_com.conf</code></p>

<pre><code>→ cat /etc/nginx/sites-enabled/www_example_com.conf
</code></pre>

<div class="highlight highlight-nginx"><pre><span class="pl-st">server</span> {
  <span class="pl-k">listen</span> <span class="pl-s1">80</span>;
  rewrite <span class="pl-sr">^ https://$</span>host<span class="pl-vo">$request_uri</span>? permanent;
}
<span class="pl-st">server</span> {
  <span class="pl-k">listen</span> <span class="pl-s1">443</span> ssl;

  <span class="pl-k">server_name</span> www.example.com;

  <span class="pl-k">include</span> /etc/nginx/wildcard_example_com.conf;

  <span class="pl-k">root</span> /var/www/example;
  <span class="pl-k">index</span> index.htm index.html;
}</pre></div>

<p>Comme nous mettons en place un certificat SSL <em>wildcard</em> pour le domaine, il est probable que nous réutiliserons la partie SSL pour plusieurs configurations de sites (sous-domaines). Nous la placerons donc dans <code>/etc/nginx/wildcard_example_com.conf</code>.</p>

<pre><code>→ cat /etc/nginx/wildcard_example_com.conf
</code></pre>

<div class="highlight highlight-nginx"><pre>ssl_certificate /etc/ssl/certs/wildcard_example_com.crt.pem;
ssl_certificate_key /etc/ssl/private/wildcard_example_com.key.pem;

ssl_session_timeout <span class="pl-c1">5m</span>;
ssl_session_cache shared:SSL:50m;

ssl_dhparam /etc/ssl/dhparam.pem;

ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers <span class="pl-s1">'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA'</span>;
ssl_prefer_server_ciphers<span class="pl-c1"> on</span>;

ssl_stapling<span class="pl-c1"> on</span>;
ssl_stapling_verify<span class="pl-c1"> on</span>;
ssl_trusted_certificate /etc/ssl/gandi-standardssl-2.chain.pem;

<span class="pl-k">resolver</span> <span class="pl-s1">127.0.0.1</span>;</pre></div>

<p><em>Ci-dessous, le nom des directives est cliquable et conduit vers la documentation de Nginx.</em></p>

<ul>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_certificate"><code>ssl_certificate</code></a> est l'emplacement du fichier de certificat</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_certificate_key"><code>ssl_certificate_key</code></a> est l'emplacement du fichier de la clé privée du certificat</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_session_timeout"><code>ssl_session_timeout</code></a> et <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_session_cache"><code>ssl_session_cache</code></a> permettent de préciser où, quelle quantité et combien de temps garder les sessions SSL. J'ai appliqué ici les recommandations de <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" title="Server Side TLS">Server-Side TLS</a>.</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_dhparam"><code>ssl_dhparam</code></a> indique l'emplacement du fichier des paramètres (généré plus haut) pour l'échange de clés Diffie-Hellman.</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_protocols"><code>ssl_protocols</code></a> est la liste des protocoles de chiffrement acceptés par le serveur. À ce jour, seuls les versions <code>TLSv1</code>, <code>TLSv1.1</code> et <code>TLSv1.2</code> de TLS sont acceptables. Plus d'info sur l'<a href="http://fr.wikipedia.org/wiki/Transport_Layer_Security#Historique">historique de SSL/TLS</a> sur Wikipedia. Les failles récentes de <code>SSLv3</code> nous ont poussés à le retirer autant que possible des listes de protocoles utilisés.</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_ciphers"><code>ssl_ciphers</code></a> est la liste ordonnée des ciphers (algorithmes de chiffrement) qui sont acceptés. La liste est directement issue du <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" title="SSL config generator">générateur de configuration</a> de <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" title="Server Side TLS">Server-Side TLS</a>
</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_prefer_server_ciphers"><code>ssl_prefer_server_ciphers</code></a> indique que la liste et l'ordre du serveur priment sur ceux indiqués par le client.</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_stapling"><code>ssl_stapling</code></a> et <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_stapling_verify"><code>ssl_stapling_verify</code></a> permettent d'activer la fonction de <strong>OCSP stapling</strong>, expliquée plus haut. <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_trusted_certificate"><code>ssl_trusted_certificate</code></a> indique à Nginx où trouver le fichier de la chaîne de certificats (généré plus haut).</li>
<li>
<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#resolver"><code>resolver</code></a> indique l'adresse qu'il faut interroger pour les résolutions de nom, utilisée lors de la vérification de validité des certificats parents, via le protocole <code>OCSP</code>.</li>
</ul>

<h1>
<a id="4-vérifications" class="anchor" href="#4-v%C3%A9rifications" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Vérifications</h1>

<p>Pendant toute la durée des vérifications, je conseille de suivre les logs d'erreur de Nginx.
Si une erreur s'est glissée quelque part, vous aurez plus de chance de la repérer comme ça.
Il se peut par exemple que l'adresse du <em>resolver</em> ne soit pas bonne (vécu sur un serveur sans <em>resolver</em> local).</p>

<pre><code>→ tail -f /var/log/nginx/error.log
</code></pre>

<p>Une fois tout ceci configuré, il faut vérifier la configuration de Nginx puis, si elle est valide, la recharger :</p>

<pre><code>→ service nginx configtest
→ service nginx reload
</code></pre>

<h2>
<a id="dans-un-navigateur" class="anchor" href="#dans-un-navigateur" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dans un navigateur</h2>

<p>Le premier test, et le plus simple, est de se rendre à l'adresse du site via un navigateur. La plupart des navigateurs propose un signe distinctif dans la barre d'adresse, qui indique si la navigation est chiffrée ou pas, si le certificat est valide.</p>

<p>Dans Chrome par exemple si vous avez un joli cadenas vert, tout va bien.
S'il est gris avec un triangle jaune, c'est presque bon mais il y a des obstacles à une navigation proprement chiffrée de bout en bout (certificat trop faible, sous-requêtes non chiffrées …).
S'il est rouge et/ou barré, alors quelque chose ne va pas du tout.</p>

<p>Et si aucun cadenas n'apparaît, c'est que la communication n'est pas chiffrée du tout.</p>

<h2>
<a id="avec-ssllabs" class="anchor" href="#avec-ssllabs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Avec <a href="https://www.ssllabs.com/ssltest/analyze.html" title="SSLLabs">SSLLabs</a>
</h2>

<p>Très bon outil en mode web pour vérifier la configuration SSL/TLS d'un domaine. Vous indiquez votre domaine et au bout d'une poignée de minutes il vous rend un rapport complet.</p>

<p>Une note synthétique vous indique la qualité de votre configuration.
Des conseils vous indiquent ce qu'il faut améliorer. Le détail de toutes les constations vos permet de savoir exactement ce qu'il en est.</p>

<h2>
<a id="avec-cipherscan" class="anchor" href="#avec-cipherscan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Avec <a href="https://github.com/jvehent/cipherscan" title="CipherScan">CipherScan</a>
</h2>

<p>Il s'agit de quelques outils, écrits par <a href="http://jve.linuxwall.info/" title="Julien Véhent">Julien Véhent</a>, pour analyser la configuration d'un domaine et faire des recommandations concrètes.</p>

<h3>
<a id="cipherscan" class="anchor" href="#cipherscan" aria-hidden="true"><span class="octicon octicon-link"></span></a>cipherscan</h3>

<p><code>cipherscan</code> est un script qui vous indique quelle est la configuration du certificat</p>

<pre><code>→ ./cipherscan www.example.com
</code></pre>

<pre><code>........................
Target: www.example.com:443

prio  ciphersuite                  protocols              pfs_keysize
1     ECDHE-RSA-AES128-GCM-SHA256  TLSv1.2                ECDH,P-256,256bits
2     ECDHE-RSA-AES256-GCM-SHA384  TLSv1.2                ECDH,P-256,256bits
3     DHE-RSA-AES128-GCM-SHA256    TLSv1.2                DH,4096bits
4     DHE-RSA-AES256-GCM-SHA384    TLSv1.2                DH,4096bits
5     ECDHE-RSA-AES128-SHA256      TLSv1.2                ECDH,P-256,256bits
6     ECDHE-RSA-AES128-SHA         TLSv1,TLSv1.1,TLSv1.2  ECDH,P-256,256bits
7     ECDHE-RSA-AES256-SHA384      TLSv1.2                ECDH,P-256,256bits
8     ECDHE-RSA-AES256-SHA         TLSv1,TLSv1.1,TLSv1.2  ECDH,P-256,256bits
9     DHE-RSA-AES128-SHA256        TLSv1.2                DH,4096bits
10    DHE-RSA-AES128-SHA           TLSv1,TLSv1.1,TLSv1.2  DH,4096bits
11    DHE-RSA-AES256-SHA256        TLSv1.2                DH,4096bits
12    DHE-RSA-AES256-SHA           TLSv1,TLSv1.1,TLSv1.2  DH,4096bits
13    AES128-GCM-SHA256            TLSv1.2
14    AES256-GCM-SHA384            TLSv1.2
15    AES128-SHA256                TLSv1.2
16    AES256-SHA256                TLSv1.2
17    AES128-SHA                   TLSv1,TLSv1.1,TLSv1.2
18    AES256-SHA                   TLSv1,TLSv1.1,TLSv1.2
19    DHE-RSA-CAMELLIA256-SHA      TLSv1,TLSv1.1,TLSv1.2  DH,4096bits
20    CAMELLIA256-SHA              TLSv1,TLSv1.1,TLSv1.2
21    DHE-RSA-CAMELLIA128-SHA      TLSv1,TLSv1.1,TLSv1.2  DH,4096bits
22    CAMELLIA128-SHA              TLSv1,TLSv1.1,TLSv1.2
23    DES-CBC3-SHA                 TLSv1,TLSv1.1,TLSv1.2

Certificate: trusted, 2048 bit, sha256WithRSAEncryption signature
TLS ticket lifetime hint: 300
OCSP stapling: supported
Server side cipher ordering
</code></pre>

<p>Il sait également exporter ses résultats au format JSON.</p>

<h3>
<a id="analyzepy" class="anchor" href="#analyzepy" aria-hidden="true"><span class="octicon octicon-link"></span></a>analyze.py</h3>

<p><code>analyze.py</code> est un script qui vous indique si votre certificat respecte le niveau souhaité</p>

<pre><code>→ ./analyze.py -l intermediate -t www.example.com
</code></pre>

<pre><code>www.example.com:443 has intermediate ssl/tls
and complies with the 'intermediate' level
</code></pre>

<p>Ce dernier peut être exécuté en <em>mode Nagios</em> afin d'automatiser des tests régulier et émettre des alertes si la conformité était compromise.</p>

<p>En plus d'analyser un site en direct, il sait utiliser en entrée un fichier JSON local (sorti de <code>cipherscan</code>), mais aussi exporter ses propres résultats dans un fichier JSON (pour par exemple garder un historique structuré des conclusions).</p>

<h3>
<a id="openssl" class="anchor" href="#openssl" aria-hidden="true"><span class="octicon octicon-link"></span></a>openssl</h3>

<p>Des version binaires d'OpenSSL sont fournies au cas où le système hôte n'en dispose pas où si elle est problématique. C'est notamment le cas pour Mac OS X.</p>

<p>Aussi bien <code>cipherscan</code> que <code>analyze.py</code> peuvent utiliser la version du système ou une version spécifique (avec l'option <code>-o</code>).</p>

<h1>
<a id="5-ressources-utiles" class="anchor" href="#5-ressources-utiles" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. Ressources utiles</h1>

<p><strong><a href="http://how2ssl.com" title="How 2 SSL">How 2 SSL</a> (en anglais)</strong></p>

<p>Une sorte de mini-wiki sur le SSL avec des clarifications et des approfondissements de certains concepts clés.</p>

<p><strong><a href="https://www.jeveuxhttps.fr/" title="Je Veux HTTPS">Je Veux HTTPS</a> (en français)</strong></p>

<p>Un bon site, écrit en français. Si je ne l'avais pas découvert tardivement, je n'aurais probablement pas écrit cet article.</p>

<p><strong><a href="https://wiki.mozilla.org/Security/Server_Side_TLS" title="Server Side TLS">Server-Side TLS</a> (en anglais)</strong></p>

<p>Un long guide, très complet, à propos de la mise en place de TLS côté serveur, avec des explications concrètes et claires sur tous les éléments en jeu.</p>

<p><strong><a href="https://jve.linuxwall.info/blog/index.php?post/2013/10/12/A-grade-SSL/TLS-with-Nginx-and-StartSSL">TLS with Nginx and StartSSL</a> (en anglais)</strong></p>

<p>Un article de <a href="http://jve.linuxwall.info/" title="Julien Véhent">Julien Véhent</a> sur un thème similaire.
Julien est OpSec chez Mozilla. Il est l'auteur de <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" title="Server Side TLS">Server-Side TLS</a>.</p>

<p><strong><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" title="SSL config generator">SSL config generator</a> (en anglais)</strong></p>

<p>Un outil d'aide à la configuration de Apache/Nginx/HAProxy, basé sur les recommandations de <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" title="Server Side TLS">Server-Side TLS</a>.</p>

<p><strong><a href="http://trac.evolix.net/infogerance/wiki/HowtoSSL" title="Howto SSL">Howto SSL</a></strong></p>

<p>Mon <a href="http://www.evolix.fr" title="Evolix">hébergeur favori</a> maintient un excellent <a href="http://trac.evolix.net/infogerance/wiki" title="Infogerance Linux et BSD">Wiki sur l'infogérance Linux/BSD</a>. Ils ont notamment un <a href="http://trac.evolix.net/infogerance/wiki/HowtoSSL" title="Howto SSL">article sur les certificats SSL</a>, avec des exemples plus précis de manipulation de certificats.</p>

<h1>
<a id="contributions" class="anchor" href="#contributions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributions</h1>

<p>Merci à ceux qui m'ont relu, conseillé, proposé des corrections et clarifications.</p>

<ul>
<li><a href="https://github.com/jefmathiot">Jef Mathiot</a></li>
<li><a href="https://github.com/jeromecc">Jérôme Pinguet</a></li>
<li><a href="https://twitter.com/benpro82">Benoît.S</a></li>
<li><a href="https://github.com/dgeo">Geoffroy Desvernay</a></li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/jlecour">jlecour</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>